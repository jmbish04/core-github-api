name = "cloudflare-worker-github-proxy"
main = "src/index.ts"
compatibility_date = "2023-07-01"

[observability]
enabled = true

[vars]
LOG_LEVEL = "info"

# [secrets]
# GITHUB_TOKEN
# WORKER_API_KEY

[durable_objects]
bindings = [
  { name = "ORCHESTRATOR", class_name = "OrchestratorAgent" }
]

[[queues.producers]]
binding = "SEARCH_QUEUE"
queue = "github-search-queue"

[[queues.consumers]]
queue = "github-search-queue"
max_batch_size = 5
max_wait_time_ms = 2000

[workflows]
include = ["src/workflows/**/*.ts"]

[[workflows.bindings]]
name = "GITHUB_SEARCH_WORKFLOW"
workflow_name = "GithubSearchWorkflow"

[[kv_namespaces]]
binding = "ETAG_KV"
id = "eed6ba4656704616acf168be80ba770a"
preview_id = "cfc441ebd1d8492497f49e88ae98aa2f"

[[d1_databases]]
binding = "CORE_GITHUB_API"
database_name = "core-github-api"
database_id = "8d945e71-1c5b-499a-a0b8-71baf2353fdd"
preview_database_id = "797f10ce-b971-469a-bee3-0f09f7d0e7a6"
migrations_dir = "migrations"

[[d1_databases]]
binding = "DB"
database_name = "github_agent"
database_id = "auto"
migrations_dir = "migrations_agents"
